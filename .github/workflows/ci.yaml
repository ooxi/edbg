name: CI


# We want to build on all branches and pull requests
#
# @see https://help.github.com/en/actions/reference/workflow-syntax-for-github-actions#on
on: [push, pull_request]


jobs:
  build:
    runs-on: ubuntu-20.04
    timeout-minutes: 30

    steps:

    # Checks-out your repository under $GITHUB_WORKSPACE
    - uses: actions/checkout@v2
      with:
        submodules: true

    # Native (Linux amd64 Clang)
#    - name: Linux amd64 Clang
#      run: docker run --volume $GITHUB_WORKSPACE:/github/workspace --workdir /github/workspace fedora:33 /github/workspace/.github/workflows/linux-amd64-clang.sh
    
    # Native (Linux amd64 GCC)
#    - name: Linux amd64 GCC
#      run: docker run --volume $GITHUB_WORKSPACE:/github/workspace --workdir /github/workspace fedora:33 /github/workspace/.github/workflows/linux-amd64-gcc.sh

    # Cross compilation (Windows amd64 mingw)
#    - name: Windows amd64 mingw
#      run: docker run --volume $GITHUB_WORKSPACE:/github/workspace --workdir /github/workspace fedora:33 /github/workspace/.github/workflows/windows-amd64-mingw.sh

    # Cross compilation (Windows amd64 mingw)
    - name: Windows i686 mingw
      run: docker run --volume $GITHUB_WORKSPACE:/source:ro --volume $GITHUB_WORKSPACE/target:/target fedora:33 /github/workspace/.github/workflows/windows-i686-mingw.sh

    # Test
    - name: test
      run: ls -la

#      run: |
#        sudo apt-get -y update
#        sudo apt-get -y install clang make libudev-dev
#    - uses: docker://fedora:33
#      args: bash -c 'echo helloworld'

#    # Prepare build environment
#    - name: Prepare build environment
#      run: npx --package mini-cross mc --no-tty _ make clean
#
#    # Native compilation, test and upload
#    - name: Native Build
#      run: npx --package mini-cross mc --no-tty _ make clean native
#
#    - name: Upload native artifact
#      uses: actions/upload-artifact@v2
#      with:
#        name: Ubuntu 20.04 amd64
#        path: build-native/binary-patch/binary-patch/executable/binary-patch-binary-patch-executable
#        if-no-files-found: error
#
#    # Cross compilation, test and upload
#    - name: Windows Build
#      run: npx --package mini-cross mc --no-tty _ make clean windows
#
#    - name: Upload Windows artifact
#      uses: actions/upload-artifact@v2
#      with:
#        name: Windows amd64
#        path: build-windows/binary-patch/binary-patch/executable/binary-patch-binary-patch-executable.exe
#        if-no-files-found: error
